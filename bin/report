#!/usr/bin/env python

import sys
import argparse
import logging
import json

from libbabywalk.db import query_completed, State


def main():

    parser = argparse.ArgumentParser()
    parser.add_argument('--verbose', '-v', action='count', default=0)
    group = parser.add_mutually_exclusive_group()
    group.add_argument('--seeds', dest='state', const=State.Requested, action='store_const')
    group.add_argument('--running', dest='state', const=State.Running, action='store_const')
    group.add_argument('--finished', dest='state', const=State.Completed, action='store_const')
    args = parser.parse_args()

    logging_level = logging.DEBUG if args.verbose else logging.INFO
    logging.basicConfig(format='crawl: %(levelname)s: %(message)s',
                        level=logging_level)

    client = pymongo.MongoClient()
    db = client.crawling

    for result in query_completed(db, args.state):
        print(json.dumps(result))


if __name__ == '__main__':
    sys.exit(main())
